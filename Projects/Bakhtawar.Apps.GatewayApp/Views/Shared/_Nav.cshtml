@using IdentityServer4.Extensions
@using Microsoft.AspNetCore.Hosting
@using Microsoft.AspNetCore.Mvc.ViewEngines
@inject IWebHostEnvironment Environment
@inject ICompositeViewEngine Engine

@{
    string name = null;
    if (!true.Equals(ViewData["signed-out"]))
    {
        name = Context.User?.GetDisplayName();
    }
}

<header class="nav-page">
    <nav class="navbar navbar-expand-sm navbar-dark navbar-toggleable-sm bg-dark border-bottom box-shadow mb-3">
        <a class="navbar-brand" href="~/">
            <img src="~/icon.png" class="icon-banner"/>
            Bakhtawar
        </a>
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a href="~/.well-known/openid-configuration" class="nav-link">Configuration</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" asp-controller="Diagnostics" asp-action="Index">Claims</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" asp-controller="Grants" asp-action="Index">Grants</a>
            </li>
        </ul>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <ul class="navbar-nav nav justify-content-end">
            @{
                var result = Engine.FindView(ViewContext, "_LoginPartial", isMainPage: false);
            }
            @if (result.Success)
            {
                await Html.RenderPartialAsync("_LoginPartial");
            }
            else
            {
                throw new InvalidOperationException("The default Identity UI layout requires a partial view '_LoginPartial' " +
                    "usually located at '/Pages/_LoginPartial' or at '/Views/Shared/_LoginPartial' to work. Based on your configuration " +
                    $"we have looked at it in the following locations: {System.Environment.NewLine}{string.Join(System.Environment.NewLine, result.SearchedLocations)}.");
            }
        </ul>
    </nav>
</header>
